{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upgrade Your Plan | TopSoftware</title>
  <meta name="description" content="Upgrade your plan with TopSoftware.">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap">
  <link rel="stylesheet" href="{% static 'payments.css' %}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="{% static 'navbar.css' %}">
  <script src="{% static 'navbar.js' %}"></script>

  <style>
    nav.navbar {
      background-color: #000 !important;
      padding: 10px 20px !important;
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000 !important;
      font-family: 'Montserrat', sans-serif !important;
    }
    html, body {
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #fff;
    }
    #payment-section .container {
      max-width: 960px;
      margin: 0 auto;
      padding-left: 20px;
      padding-right: 20px;
    }
    .card {
      background-color: #fff;
      color: #000;
    }
  </style>
</head>
<body>
  {% include 'navbar.html' %}

  <section id="payment-section" style="padding-top: 180px;">
    <div class="container mt-5 mb-5 d-flex justify-content-center">
      <div class="card p-5">
        <div>
          <h4 class="heading">Upgrade your plan</h4>
          <p class="text">Please make the payment to start enjoying all the features of our premium plan.</p>
        </div>

        <!-- Page quantity inputs -->
        <div class="mt-3">
          <label for="quantity-premium" class="fw-bold">1-3 Pages ($250 each):</label>
          <input type="number" id="quantity-premium" class="form-control" value="0" min="0" />
        </div>
        <div class="mt-3">
          <label for="quantity-basic" class="fw-bold">4-7 Pages ($210 each):</label>
          <input type="number" id="quantity-basic" class="form-control" value="0" min="0" />
        </div>
        <div class="mt-3">
          <label for="quantity-starter" class="fw-bold">7+ Pages ($180 each):</label>
          <input type="number" id="quantity-starter" class="form-control" value="0" min="0" />
        </div>
        <div class="mt-3">
          <label for="quantity-starterpack" class="fw-bold">Starter Pack - Landing Page ($55 each):</label>
          <input type="number" id="quantity-starterpack" class="form-control" value="0" min="0" />
        </div>

        <!-- Custom amount toggle -->
        <div class="mt-4">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="custom-toggle" onchange="toggleCustomAmount()">
            <label class="form-check-label fw-bold" for="custom-toggle">I want to pay a custom amount</label>
          </div>
        </div>

        <!-- Custom amount input -->
        <div class="mt-3" id="custom-amount-section" style="display: none;">
          <label for="custom-amount" class="fw-bold">Enter custom amount ($):</label>
          <input type="number" id="custom-amount" class="form-control" placeholder="0.00" min="0" step="0.01" />
        </div>

        <!-- Additional info -->
        <div class="mt-4">
          <label for="additional-details" class="fw-bold">Additional Details:</label>
          <textarea id="additional-details" class="form-control" rows="3" placeholder="Enter any details..."></textarea>
        </div>

        <!-- Total amount -->
        <div class="mt-4">
          <h5>Total Amount: <span id="total-price">$0.00</span></h5>
        </div>

        <!-- PayPal Button -->
        <div id="paypal-button-container" class="mt-4"></div>
      </div>
    </div>
  </section>

  <!-- PayPal JS SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AdIOdwGbHBKpREd3SXfhvoXY214yqYYnRt0jExL97hutsewKrcnF-2CcIFUnqg7koC2iuPIFa0yzA7a_HERE&currency=USD"></script>

  <script>
    let totalAmount = 0;

    const premiumPrice = 250;
    const basicPrice = 210;
    const starterPrice = 180;
    const starterPackPrice = 55;

    function updateTotal() {
      const isCustom = document.getElementById("custom-toggle").checked;
      if (isCustom) {
        const custom = parseFloat(document.getElementById("custom-amount").value || 0);
        totalAmount = custom;
      } else {
        const qPremium = parseInt(document.getElementById("quantity-premium").value || 0);
        const qBasic = parseInt(document.getElementById("quantity-basic").value || 0);
        const qStarter = parseInt(document.getElementById("quantity-starter").value || 0);
        const qStarterPack = parseInt(document.getElementById("quantity-starterpack").value || 0);

        totalAmount = (qPremium * premiumPrice) +
                      (qBasic * basicPrice) +
                      (qStarter * starterPrice) +
                      (qStarterPack * starterPackPrice);
      }

      document.getElementById("total-price").innerText = `$${totalAmount.toFixed(2)}`;
    }

    function toggleCustomAmount() {
      const isCustom = document.getElementById("custom-toggle").checked;
      document.getElementById("custom-amount-section").style.display = isCustom ? "block" : "none";

      ["quantity-premium", "quantity-basic", "quantity-starter", "quantity-starterpack"].forEach(id => {
        document.getElementById(id).disabled = isCustom;
      });

      updateTotal();
    }

    // Update total on input change
    document.addEventListener("DOMContentLoaded", () => {
      ["quantity-premium", "quantity-basic", "quantity-starter", "quantity-starterpack", "custom-amount"]
        .forEach(id => {
          document.getElementById(id)?.addEventListener("input", updateTotal);
        });

      updateTotal();

      paypal.Buttons({
        createOrder: function(data, actions) {
          if (totalAmount <= 0) {
            alert("Please select a plan or enter a custom amount.");
            return;
          }
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: totalAmount.toFixed(2)
              },
              description: document.getElementById("additional-details").value || "TopSoftware Payment"
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            alert('Payment completed successfully by ' + details.payer.name.given_name + '!');
            // Optionally: send to your server to store order info
          });
        },
        onError: function(err) {
          console.error(err);
          alert("An error occurred during payment. Please try again.");
        }
      }).render('#paypal-button-container');
    });
  </script>
</body>
</html>
