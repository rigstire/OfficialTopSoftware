{% extends 'base.html' %}

{% block content %}
  <section id="payment-section" class="container mt-5 mb-5">
    <div class="card">
      <h4 class="section-heading">Upgrade your plan</h4>
      <p>Please make the payment to start enjoying all the features of our premium plan.</p>

      <!-- Product Pricing Blocks -->
      <div>
        <label for="quantity-premium" class="fw-bold">1-3 Pages ($250 each):</label>
        <input type="number" id="quantity-premium" class="form-control" value="0" min="0" onchange="updateTotal()" />

        <label for="quantity-basic" class="fw-bold">4-7 Pages ($210 each):</label>
        <input type="number" id="quantity-basic" class="form-control" value="0" min="0" onchange="updateTotal()" />

        <label for="quantity-starter" class="fw-bold">7+ Pages ($180 each):</label>
        <input type="number" id="quantity-starter" class="form-control" value="0" min="0" onchange="updateTotal()" />

        <label for="quantity-starterpack" class="fw-bold">Starter Pack - Landing Page ($55 each):</label>
        <input type="number" id="quantity-starterpack" class="form-control" value="0" min="0" onchange="updateTotal()" />
      </div>

      <!-- Toggle Custom Amount -->
      <div class="mt-4">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="custom-toggle" onchange="toggleCustomAmount()" />
          <label class="form-check-label fw-bold" for="custom-toggle">I want to pay a custom amount</label>
        </div>
      </div>

      <!-- Custom Amount -->
      <div class="mt-3" id="custom-amount-section" style="display: none;">
        <label for="custom-amount" class="fw-bold">Enter custom amount ($):</label>
        <input type="number" id="custom-amount" class="form-control" value="0" min="0" step="0.01" onchange="updateTotal()" />
      </div>

      <!-- Additional Info -->
      <div class="mt-4 additional-info">
        <label for="additional-details" class="fw-bold">Additional Details (e.g., website ideas, company name):</label>
        <textarea id="additional-details" class="form-control" rows="3" placeholder="Enter any details..."></textarea>
      </div>

      <!-- Total -->
      <div class="mt-4">
        <h5>Total Amount: <span id="total-price">$0.00</span></h5>
      </div>

      <!-- PayPal Checkout -->
      <div id="paypal-button-container" class="mt-4"></div>
    </div>
  </section>

  <!-- PayPal.js SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AdIOdwGbHBKpREd3SXfhvoXY214yqYYnRt0jExL97hutsewKrcnF-2CcIFUnqg7koC2iuPIFa0yzA7a_&currency=USD"></script>
  
  <script>
    let totalAmount = 0;

    const premiumPrice = 25000;
    const basicPrice = 21000;
    const starterPrice = 18000;
    const starterPackPrice = 5500;

    document.addEventListener("DOMContentLoaded", function () {
      updateTotal();  // Set initial total

      // PayPal Buttons integration
      paypal.Buttons({
        createOrder: function (data, actions) {
          if (totalAmount === 0) {
            alert("Please select a plan or enter a custom amount.");
            return;
          }

          return actions.order.create({
            purchase_units: [{
              amount: {
                value: (totalAmount / 100).toFixed(2)
              },
              description: document.getElementById("additional-details").value || "TopSoftware Payment"
            }]
          });
        },
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            alert("Payment completed by " + details.payer.name.given_name);
            // Optionally, send details to your backend for further processing
          });
        },
        onError: function (err) {
          console.error("PayPal error:", err);
          alert("Something went wrong with PayPal. Please try again.");
        }
      }).render('#paypal-button-container');
    });

    function updateTotal() {
      const qPremium = parseInt(document.getElementById("quantity-premium").value || 0);
      const qBasic = parseInt(document.getElementById("quantity-basic").value || 0);
      const qStarter = parseInt(document.getElementById("quantity-starter").value || 0);
      const qStarterPack = parseInt(document.getElementById("quantity-starterpack").value || 0);
      const customAmountChecked = document.getElementById("custom-toggle").checked;

      if (customAmountChecked) {
        const customAmount = parseFloat(document.getElementById("custom-amount").value || 0);
        totalAmount = Math.round(customAmount * 100);  // Convert to cents
      } else {
        totalAmount = (qPremium * premiumPrice) + (qBasic * basicPrice) + (qStarter * starterPrice) + (qStarterPack * starterPackPrice);
      }

      document.getElementById("total-price").textContent = `$${(totalAmount / 100).toFixed(2)}`;
    }

    function toggleCustomAmount() {
      const isChecked = document.getElementById("custom-toggle").checked;
      document.getElementById("custom-amount-section").style.display = isChecked ? "block" : "none";
      document.getElementById("quantity-premium").disabled = isChecked;
      document.getElementById("quantity-basic").disabled = isChecked;
      document.getElementById("quantity-starter").disabled = isChecked;
      document.getElementById("quantity-starterpack").disabled = isChecked;
      updateTotal();
    }
  </script>
{% endblock %}
